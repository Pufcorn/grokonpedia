<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Grokonpedia – Lecture</title>
<style>
    body {
        background: #333;
        color: #fff;
        font-family: sans-serif;
        margin: 20px;
        line-height: 1.4;
    }
    #content {
        max-width: 800px;
        margin: auto;
        padding: 20px;
        background: #444;
        border-radius: 10px;
    }
    h1 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 2em;
    }
    .word {
        font-weight: bold;
        font-size: 1.3em;
        margin-top: 15px;
        margin-bottom: 5px;
    }
    .definition {
        margin-left: 10px;
        margin-bottom: 15px;
    }
</style>
</head>
<body>

<div id="content">Chargement…</div>

<script>
const params = new URLSearchParams(window.location.search);
const file = params.get('f');

if (!file) {
    document.getElementById('content').innerHTML = "Erreur : aucune lettre reçue.";
}

fetch(`${file}.md`)
    .then(r => r.text())
    .then(txt => {
        // Nettoyage automatique Markdown
        txt = txt.replace(/^#.*$/gm, ""); // Supprime toutes les lignes de titre
        txt = txt.replace(/^#+\s*/gm, ""); // Supprime les ### devant les mots
        txt = txt.replace(/Conversion Markdown/gi, ""); // Supprime Conversion Markdown

        const lines = txt.split(/\n+/);

        let html = "";

        // La première ligne non vide → lettre
        let letter = lines.find(l => l.trim() !== "");
        html += `<h1>${letter.trim()}</h1>`;

        // Supprime cette ligne de l’array
        const startIndex = lines.indexOf(letter);
        const contentLines = lines.slice(startIndex + 1);

        contentLines.forEach(line => {
            line = line.trim();
            if (!line) return;
            // Si ligne commence par "v.", "n.", "adj.", "Expr.", "EX" ou "—", c'est une définition
            if (/^(v\.|n\.|adj\.|Expr\.|EX|—)/.test(line)) {
                html += `<div class="definition">${line}</div>`;
            } else {
                html += `<div class="word">${line}</div>`;
            }
        });

        document.getElementById("content").innerHTML = html;
    })
    .catch(err => {
        document.getElementById('content').innerHTML = "Erreur de chargement.";
    });
</script>

</body>
</html>
